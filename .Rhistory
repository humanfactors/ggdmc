p0 <- ggplot(dat, aes(x = X, y = RT, colour = s)) +
geom_point() +
theme_bw(base_size = 14)
# facet_wrap(.~s)
plot(p0)
p0 <- ggplot(dat, aes(x = X, y = RT, group = s)) +
geom_point() + geom_line()
p0 <- ggplot(dat, aes(x = X, y = RT, group = s)) +
geom_point() + geom_line() +
theme_bw(base_size = 14)
# facet_wrap(.~s)
plot(p0)
p0 <- ggplot(dat, aes(x = X, y = RT, group = s, color = s)) +
geom_point() + geom_line() +
theme_bw(base_size = 14)
# facet_wrap(.~s)
plot(p0)
p0 <- ggplot(dat, aes(x = X, y = RT, group = s, color = s)) +
geom_point() + geom_line() + ylab("Y") +
theme_bw(base_size = 14)
# facet_wrap(.~s)
plot(p0)
pstart <- BuildPrior(
dists = c("tnorm", "tnorm", "tnorm"),
p1    = c(a = 242,  b = 6.19, tau = .027),
p2    = c(a = 14, b = .49, tau = 10),
lower = c(NA, NA, 0),
upper = rep(NA, npar))
lstart <- BuildPrior(
dists = c("tnorm", "tnorm", "tnorm"),
p1    = c(a = 200,  b = 5, tau = .01),
p2    = c(a = 50, b = 1, tau = .01),
lower = c(NA, NA, 0),
upper = rep(NA, npar))
sstart <- BuildPrior(
dists = c("tnorm", "tnorm", "tnorm"),
p1    = c(a = 10,  b = .5, tau = .01),
p2    = c(a = 5, b = .1, tau = .01),
lower = c(NA, NA, 0),
upper = rep(NA, npar))
start <- list(pstart, lstart, sstart)
p.prior  <- BuildPrior(
dists = rep("tnorm2", npar),
p1    = c(a = NA, b = NA, tau = NA),
p2    = rep(NA, 3),
lower = c(NA, 0, 0),
upper = rep(NA, npar))
loc <- c(a = 200, b = 6, tau = 3)
sca <- c(a = 1e-4, b = 1e-3, tau = 1e-2)
mu.prior  <- BuildPrior(
dists = rep("tnorm2", npar),
p1    = loc,
p2    = sca,
lower = c(NA, 0, 0),
upper = rep(NA, npar))
sigma.prior <- BuildPrior(
dists = rep("gamma", npar),
p1    = c(a = .01, b = .01, tau = .01),
p2    = c(a = 1000,  b = 1000, tau = 1000),
lower = c(0, 0, 0),
upper = rep(NA, npar))
prior <- list(p.prior, mu.prior, sigma.prior)
fit0 <- StartNewhiersamples(500, dmi, start, prior, .001, 8, 9)
fit <- run(fit0)
thin <- 2
# repeat {
fit <- run(RestartHypersamples(5e2, fit, thin = thin))
p0 <- plot(fit, hyper = TRUE)
fit0 <- StartNewhiersamples(500, dmi, start, prior, .001, 8, 9)
fit <- run(fit0)
fit0 <- StartNewhiersamples(500, dmi, start, prior)
fit <- run(fit0)
p0 <- plot(fit, hyper = TRUE)
thin <- 2
# repeat {
fit <- run(RestartHypersamples(5e2, fit, thin = thin))
p0 <- plot(fit, hyper = TRUE)
p0 <- plot(fit, hyper = TRUE, start = 101)
est1 <- summary(fit, hyper = TRUE, recover = TRUE, start = 101,
ps = pop.mean,  type = 1, verbose = TRUE)
est2 <- summary(fit, hyper = TRUE, recover = TRUE, start = 101,
ps = pop.scale, type = 2, verbose = TRUE)
est3 <- summary(fit, recover = TRUE, ps = ps, verbose = TRUE)
rm(list = ls())
setwd("/media/yslin/KIWI/Documents/ggdmc/")
model <- BuildModel(
p.map      = list(a = "1", b = "1", tau = "1"),
match.map  = NULL,
regressors = c(8, 15, 22, 29, 36),
factors    = list(S = c("x1")),
responses  = "r1",
constants  = NULL,
type       = "glm")
npar <- length(GetPNames(model))
pop.mean <- c(a = 242.7, b = 6.185, tau = 6.086)
pop.scale <- c(a = 1e-4, b = .04, tau = .04)
ntrial <- 100
pop.prior  <-BuildPrior(
dists = rep("tnorm2", npar),
p1    = pop.mean,
p2    = pop.scale,
lower = c(NA, 0, 0),
upper = rep(NA, npar))
1/6.071^2
npar <- length(GetPNames(model))
pop.mean <- c(a = 242.7, b = 6.189, tau = .027)
pop.scale <- c(a = .005, b = 3.879, tau = .04)
ntrial <- 100
pop.prior  <-BuildPrior(
dists = rep("tnorm2", npar),
p1    = pop.mean,
p2    = pop.scale,
lower = c(NA, 0, 0),
upper = rep(NA, npar))
plot(pop.prior, ps = pop.mean)
dat <- simulate(model, nsub = 100, nsim = ntrial, prior = pop.prior)
dmi <- BuildDMI(dat, model)
ps <- attr(dat, "parameters")
colMeans(ps)
matrixStats::colSds(ps)
pstart <- BuildPrior(
dists = c("tnorm", "tnorm", "tnorm"),
p1    = c(a = 242,  b = 6.19, tau = .027),
p2    = c(a = 14, b = .49, tau = 10),
lower = c(NA, NA, 0),
upper = rep(NA, npar))
lstart <- BuildPrior(
dists = c("tnorm", "tnorm", "tnorm"),
p1    = c(a = 200,  b = 5, tau = .01),
p2    = c(a = 50, b = 1, tau = .01),
lower = c(NA, NA, 0),
upper = rep(NA, npar))
sstart <- BuildPrior(
dists = c("tnorm", "tnorm", "tnorm"),
p1    = c(a = 10,  b = .5, tau = .01),
p2    = c(a = 5, b = .1, tau = .01),
lower = c(NA, NA, 0),
upper = rep(NA, npar))
start <- list(pstart, lstart, sstart)
p.prior  <- BuildPrior(
dists = rep("tnorm2", npar),
p1    = c(a = NA, b = NA, tau = NA),
p2    = rep(NA, 3),
lower = c(NA, 0, 0),
upper = rep(NA, npar))
loc <- c(a = 200, b = 6, tau = 3)
sca <- c(a = 1e-4, b = 1e-3, tau = 1e-2)
mu.prior  <- BuildPrior(
dists = rep("tnorm2", npar),
p1    = loc,
p2    = sca,
lower = c(NA, 0, 0),
upper = rep(NA, npar))
sigma.prior <- BuildPrior(
dists = rep("gamma", npar),
p1    = c(a = .01, b = .01, tau = .01),
p2    = c(a = 1000,  b = 1000, tau = 1000),
lower = c(0, 0, 0),
upper = rep(NA, npar))
prior <- list(p.prior, mu.prior, sigma.prior)
fit0 <- StartNewhiersamples(500, dmi, start, prior)
fit <- run(fit0)
thin <- 2
# repeat {
fit <- run(RestartHypersamples(5e2, fit, thin = thin))
p0 <- plot(fit, hyper = TRUE)
p0 <- plot(fit, hyper = TRUE, start = 101)
est1 <- summary(fit, hyper = TRUE, recover = TRUE, start = 101,
ps = pop.mean,  type = 1, verbose = TRUE)
est2 <- summary(fit, hyper = TRUE, recover = TRUE, start = 101,
ps = pop.scale, type = 2, verbose = TRUE)
dat <- simulate(model, nsub = 300, nsim = ntrial, prior = pop.prior)
dmi <- BuildDMI(dat, model)
fit0 <- StartNewhiersamples(500, dmi, start, prior)
fit <- run(fit0)
est1 <- summary(fit, hyper = TRUE, recover = TRUE, start = 101,
ps = pop.mean,  type = 1, verbose = TRUE)
est2 <- summary(fit, hyper = TRUE, recover = TRUE, start = 101,
ps = pop.scale, type = 2, verbose = TRUE)
est2 <- summary(fit, hyper = TRUE, recover = TRUE, start = 101,
ps = pop.scale, type = 2, verbose = TRUE, digits = 3)
est1 <- summary(fit, hyper = TRUE, recover = TRUE, start = 101,
ps = pop.mean,  type = 1, verbose = TRUE, digits = 3)
npar <- length(GetPNames(model))
pop.mean <- c(a = 242.7, b = 6.189, tau = .03)
pop.scale <- c(a = .005, b = 3.879, tau = .04)
ntrial <- 100
pop.prior  <-BuildPrior(
dists = rep("tnorm2", npar),
p1    = pop.mean,
p2    = pop.scale,
lower = c(NA, 0, 0),
upper = rep(NA, npar))
plot(pop.prior, ps = pop.mean)
dat <- simulate(model, nsub = 1000, nsim = ntrial, prior = pop.prior)
dmi <- BuildDMI(dat, model)
ps <- attr(dat, "parameters")
colMeans(ps)
matrixStats::colSds(ps)
pstart <- BuildPrior(
dists = c("tnorm", "tnorm", "tnorm"),
p1    = c(a = 242,  b = 6.19, tau = .027),
p2    = c(a = 14, b = .49, tau = 10),
lower = c(NA, NA, 0),
upper = rep(NA, npar))
lstart <- BuildPrior(
dists = c("tnorm", "tnorm", "tnorm"),
p1    = c(a = 200,  b = 5, tau = .01),
p2    = c(a = 50, b = 1, tau = .01),
lower = c(NA, NA, 0),
upper = rep(NA, npar))
sstart <- BuildPrior(
dists = c("tnorm", "tnorm", "tnorm"),
p1    = c(a = 10,  b = .5, tau = .01),
p2    = c(a = 5, b = .1, tau = .01),
lower = c(NA, NA, 0),
upper = rep(NA, npar))
start <- list(pstart, lstart, sstart)
p.prior  <- BuildPrior(
dists = rep("tnorm2", npar),
p1    = c(a = NA, b = NA, tau = NA),
p2    = rep(NA, 3),
lower = c(NA, 0, 0),
upper = rep(NA, npar))
loc <- c(a = 200, b = 6, tau = 3)
sca <- c(a = 1e-4, b = 1e-3, tau = 1e-2)
mu.prior  <- BuildPrior(
dists = rep("tnorm2", npar),
p1    = loc,
p2    = sca,
lower = c(NA, 0, 0),
upper = rep(NA, npar))
sigma.prior <- BuildPrior(
dists = rep("gamma", npar),
p1    = c(a = .01, b = .01, tau = .01),
p2    = c(a = 1000,  b = 1000, tau = 1000),
lower = c(0, 0, 0),
upper = rep(NA, npar))
prior <- list(p.prior, mu.prior, sigma.prior)
fit0 <- StartNewhiersamples(500, dmi, start, prior)
fit <- run(fit0)
p0 <- plot(fit, hyper = TRUE)
p0 <- plot(fit, hyper = TRUE, start = 101)
thin <- 2
# repeat {
fit <- run(RestartHypersamples(5e2, fit, thin = thin))
p0 <- plot(fit, hyper = TRUE)
est1 <- summary(fit, hyper = TRUE, recover = TRUE, start = 101,
ps = pop.mean,  type = 1, verbose = TRUE, digits = 3)
est2 <- summary(fit, hyper = TRUE, recover = TRUE, start = 101,
ps = pop.scale, type = 2, verbose = TRUE, digits = 3)
est3 <- summary(fit, recover = TRUE, ps = ps, verbose = TRUE)
d <- data.table(dat)
d
d[, .N, ]
d[, .N, .(s)]
plot(pop.prior, ps = pop.mean)
colMeans(ps)
matrixStats::colSds(ps)
mu_avg <- colMeans(ps)
sd_avg <- matrixStats::colSds(ps)
mu_avg
sd_avg
ps <- attr(dat, "parameters")
mu_avg <- colMeans(ps)
sd_avg <- matrixStats::colSds(ps)
mu_avg
sd_avg
1/sqrt(pop.scale)
1/sqrt(pop.scale)
getwd()
?png
png("~/myblog/images/BUGS/pop_prior.png", 800, 600)
plot(pop.prior, ps = pop.mean)
dev.off()
mu_avg <- colMeans(ps)
sd_avg <- matrixStats::colSds(ps)
1/sqrt(pop.scale)
mu_avg - pop.mean
true_sd <- 1/sqrt(pop.scale)
p.prior  <- BuildPrior(
dists = rep("tnorm2", npar),
p1    = c(a = NA, b = NA, tau = NA),
p2    = rep(NA, 3),
lower = c(NA, 0, 0),
upper = rep(NA, npar))
mu.prior  <- BuildPrior(
dists = rep("tnorm2", npar),
p1    = c(a = 0, b = 0, tau = 0),
p2    = c(a = 1e-4, b = 1e-4, tau = 1e-4),
lower = c(NA, 0, 0),
upper = rep(NA, npar))
sigma.prior <- BuildPrior(
dists = rep("gamma", npar),
p1    = c(a = .001, b = .001, tau = .001),
p2    = c(a = 1000,  b = 1000, tau = 1000),
lower = c(0, 0, 0),
upper = rep(NA, npar))
prior <- list(p.prior, mu.prior, sigma.prior)
rm(list = ls())
setwd("/media/yslin/KIWI/Documents/ggdmc/")
model <- BuildModel(
p.map      = list(a = "1", b = "1", tau = "1"),
match.map  = NULL,
regressors = c(8, 15, 22, 29, 36),
factors    = list(S = c("x1")),
responses  = "r1",
constants  = NULL,
type       = "glm")
npar <- length(GetPNames(model))
pop.mean <- c(a = 242.7, b = 6.189, tau = .03)
pop.scale <- c(a = .005, b = 3.879, tau = .04)
ntrial <- 100
pop.prior  <-BuildPrior(
dists = rep("tnorm2", npar),
p1    = pop.mean,
p2    = pop.scale,
lower = c(NA, 0, 0),
upper = rep(NA, npar))
png("~/myblog/images/BUGS/pop_prior.png", 800, 600)
plot(pop.prior, ps = pop.mean)
dev.off()
dat <- simulate(model, nsub = 1000, nsim = ntrial, prior = pop.prior)
dmi <- BuildDMI(dat, model)
ps <- attr(dat, "parameters")
pstart <- BuildPrior(
dists = c("tnorm", "tnorm", "tnorm"),
p1    = c(a = 242,  b = 6.19, tau = .027),
p2    = c(a = 14, b = .49, tau = 10),
lower = c(NA, NA, 0),
upper = rep(NA, npar))
lstart <- BuildPrior(
dists = c("tnorm", "tnorm", "tnorm"),
p1    = c(a = 200,  b = 5, tau = .01),
p2    = c(a = 50, b = 1, tau = .01),
lower = c(NA, NA, 0),
upper = rep(NA, npar))
sstart <- BuildPrior(
dists = c("tnorm", "tnorm", "tnorm"),
p1    = c(a = 10,  b = .5, tau = .01),
p2    = c(a = 5, b = .1, tau = .01),
lower = c(NA, NA, 0),
upper = rep(NA, npar))
start <- list(pstart, lstart, sstart)
p.prior  <- BuildPrior(
dists = rep("tnorm2", npar),
p1    = c(a = NA, b = NA, tau = NA),
p2    = rep(NA, 3),
lower = c(NA, 0, 0),
upper = rep(NA, npar))
mu.prior  <- BuildPrior(
dists = rep("tnorm2", npar),
p1    = c(a = 0, b = 0, tau = 0),
p2    = c(a = 1e-4, b = 1e-4, tau = 1e-4),
lower = c(NA, 0, 0),
upper = rep(NA, npar))
sigma.prior <- BuildPrior(
dists = rep("gamma", npar),
p1    = c(a = .001, b = .001, tau = .001),
p2    = c(a = 1000,  b = 1000, tau = 1000),
lower = c(0, 0, 0),
upper = rep(NA, npar))
prior <- list(p.prior, mu.prior, sigma.prior)
fit0 <- StartNewhiersamples(500, dmi, start, prior)
fit <- run(fit0)
thin <- 2
# repeat {
fit <- run(RestartHypersamples(5e2, fit, thin = thin))
p0 <- plot(fit, hyper = TRUE)
p0 <- plot(fit, hyper = TRUE, start = 101)
thin <- 16
# repeat {
fit <- run(RestartHypersamples(5e2, fit, thin = thin))
rhat <- hgelman(fit, verbose = TRUE)
p0 <- plot(fit, hyper = TRUE)
thin <- 1
thin <- 1
# repeat {
fit <- run(RestartHypersamples(5e2, fit, thin = thin), hpm0 = .05)
p0 <- plot(fit, hyper = TRUE)
p0 <- plot(fit, hyper = TRUE, start = 101)
p0 <- plot(fit, hyper = TRUE, start = 201)
thin <- 1
# repeat {
fit <- run(RestartHypersamples(5e2, fit, thin = thin))
est1 <- summary(fit, hyper = TRUE, recover = TRUE, start = 101,
ps = pop.mean,  type = 1, verbose = TRUE, digits = 3)
est2 <- summary(fit, hyper = TRUE, recover = TRUE, start = 101,
ps = pop.scale, type = 2, verbose = TRUE, digits = 3)
est3 <- summary(fit, recover = TRUE, ps = ps, verbose = TRUE)
hes <- effectiveSize(fit, hyper = TRUE)
hes
es <- effectiveSize(fit[[1]])
es
p0 <- plot(fit, hyper = TRUE)
p1 <- plot(fit, hyper = TRUE, pll = FALSE, den = TRUE)
png("~/myblog/images/BUGS/traceplot1.png", 800, 600)
p0 <- plot(fit, hyper = TRUE)
dev.off()
png("~/myblog/images/BUGS/densityplot1.png", 800, 600)
p1 <- plot(fit, hyper = TRUE, pll = FALSE, den = TRUE)
dev.off()
setwd("/media/yslin/KIWI/Documents/ggdmc/")
setwd("/media/yslin/KIWI/Documents/Bayesian_rats_GA/")
tmp <- dget("data/Rats_data.R")
## Control groups
d <- data.frame(matrix(as.vector(tmp$Y), nrow = 30, byrow = TRUE))
names(d) <- c(8, 15, 22, 29, 36)
d$s <- factor(1:tmp$N)
long <- melt(d, id.vars = c("s"), variable.name = "xfac",
value.name = "RT")
dplyr::tbl_df(long)
long$X <- as.double(as.character(long$xfac)) - tmp$xbar
long$S <- factor("x1")
long$R <- factor("r1")
d <- long[, c("s", "S", "R", "X", "RT")]
p1 <- ggplot(d, aes(x = X, y = RT, group = s)) +
geom_point() + geom_line() +
theme_bw(base_size = 14)
plot(p1)
dplyr::tbl_df(d)
setwd("/media/yslin/KIWI/Documents/ggdmc/")
fit0 <- StartNewhiersamples(500, dmi, start, prior)
fit <- run(fit0)
tmp <- dget("data/Rats_data.R")
setwd("/media/yslin/KIWI/Documents/Bayesian_rats_GA/")
tmp <- dget("data/Rats_data.R")
## Control groups
d <- data.frame(matrix(as.vector(tmp$Y), nrow = 30, byrow = TRUE))
names(d) <- c(8, 15, 22, 29, 36)
d$s <- factor(1:tmp$N)
long <- melt(d, id.vars = c("s"), variable.name = "xfac",
value.name = "RT")
dplyr::tbl_df(long)
long$X <- as.double(as.character(long$xfac)) - tmp$xbar
long$S <- factor("x1")
long$R <- factor("r1")
d <- long[, c("s", "S", "R", "X", "RT")]
p1 <- ggplot(d, aes(x = X, y = RT, group = s)) +
geom_point() + geom_line() +
theme_bw(base_size = 14)
plot(p1)
dplyr::tbl_df(d)
setwd("/media/yslin/KIWI/Documents/ggdmc/")
dmi <- BuildDMI(d, model)
d[, .N .(s)]
d[, .N, .(s)]
DT <- data.table(d)
DT[, .N, .(s)]
fit0 <- StartNewhiersamples(500, dmi, start, prior)
fit <- run(fit0)
p0 <- plot(fit, hyper = TRUE)
p0 <- plot(fit, hyper = TRUE, start = 101)
thin <- 16
# repeat {
fit <- run(RestartHypersamples(5e2, fit, thin = thin))
p0 <- plot(fit, hyper = TRUE)
p0 <- plot(fit, hyper = TRUE, start = 101)
thin <- 2
# repeat {
fit <- run(RestartHypersamples(5e2, fit, thin = thin))
p0 <- plot(fit, hyper = TRUE)
rhat <- hgelman(fit, verbose = TRUE)
est1 <- summary(fit, hyper = TRUE, recover = TRUE, start = 101,
ps = pop.mean,  type = 1, verbose = TRUE, digits = 3)
est2 <- summary(fit, hyper = TRUE, recover = TRUE, start = 101,
ps = pop.scale, type = 2, verbose = TRUE, digits = 3)
hes <- effectiveSize(fit, hyper = TRUE)
hes
es <- effectiveSize(fit[[1]])
es
thin <- 32
# repeat {
fit <- run(RestartHypersamples(5e2, fit, thin = thin))
DT[, .N, .(s)]
est1 <- summary(fit, hyper = TRUE, recover = TRUE, start = 101,
ps = pop.mean,  type = 1, verbose = TRUE, digits = 3)
est1 <- summary(fit, hyper = TRUE, recover = TRUE,
ps = pop.mean,  type = 1, verbose = TRUE, digits = 3)
est2 <- summary(fit, hyper = TRUE, recover = TRUE,
ps = pop.scale, type = 2, verbose = TRUE, digits = 3)
est1 <- summary(fit, hyper = TRUE, type = 1, verbose = TRUE, digits = 3)
est1
est1 <- summary(fit, hyper = TRUE, type = 1, verbose = FALSE, digits = 3)
est1
est1 <- summary(fit, hyper = TRUE, type = 1, verbose = TRUE, digits = 3)
est1
p0 <- plot(fit, hyper = TRUE)
png("~/myblog/images/BUGS/traceplot_rat.png", 800, 600)
p0 <- plot(fit, hyper = TRUE)
dev.off()
png("~/myblog/images/BUGS/densityplot_rat.png", 800, 600)
p1 <- plot(fit, hyper = TRUE, pll = FALSE, den = TRUE)
dev.off()
hes <- effectiveSize(fit, hyper = TRUE)
hes
es <- effectiveSize(fit[[1]])
es
es <- effectiveSize(fit)
es <- effectiveSize(fit)
round(apply(data.frame(es), 1, mean))
round(apply(data.frame(es), 1, sd))
round(apply(data.frame(es), 1, max))
round(apply(data.frame(es), 1, min))
hes <- effectiveSize(fit, hyper = TRUE)
hes
png("~/myblog/images/BUGS/traceplot_rats.png", 800, 600)
p0 <- plot(fit, hyper = TRUE)
dev.off()
png("~/myblog/images/BUGS/densityplot_rats.png", 800, 600)
p1 <- plot(fit, hyper = TRUE, pll = FALSE, den = TRUE)
dev.off()
